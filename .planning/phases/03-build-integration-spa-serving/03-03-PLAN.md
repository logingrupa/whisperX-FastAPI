---
phase: 03-build-integration-spa-serving
plan: 03
type: execute
wave: 3
depends_on: ["03-01", "03-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can access React app at /ui in browser"
    - "User can refresh any client-side route without 404"
    - "Dev mode proxies API calls to FastAPI"
    - "Production build serves from FastAPI"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete build integration by testing development workflow, production build, and SPA routing.

Purpose: Confirms Phase 3 success criteria are met before moving to Phase 4. Catches integration issues that automated tests might miss.

Output: Verified working frontend integration ready for UI development.
</objective>

<execution_context>
@C:\Users\rolan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\rolan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-build-integration-spa-serving/03-01-SUMMARY.md
@.planning/phases/03-build-integration-spa-serving/03-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build Production Frontend</name>
  <files></files>
  <action>
Build the frontend for production to enable FastAPI serving:

1. Run build command:
   ```bash
   cd C:\laragon\www\whisperx
   bun run build:ui
   ```

2. Verify build output:
   - frontend/dist/ directory created
   - frontend/dist/index.html exists
   - frontend/dist/assets/ contains .js and .css files
   - Asset paths in index.html start with /ui/assets/

3. Check for build warnings:
   - No TypeScript errors
   - No missing dependencies
   - Bundle size is reasonable (< 500KB for initial load)
  </action>
  <verify>
    - `ls frontend/dist/` shows index.html and assets/
    - `grep -o '/ui/assets' frontend/dist/index.html` returns matches
    - Build completes without errors
  </verify>
  <done>
    - Production build created in frontend/dist/
    - Asset paths correctly prefixed with /ui/
    - No build errors or warnings
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete SPA integration with:
- React frontend with Vite, TypeScript, Tailwind
- FastAPI SPA handler serving at /ui
- Development proxy for API and WebSocket
- Production build with correct base path
- Loading skeleton and noscript fallback
  </what-built>
  <how-to-verify>
**Test 1: Development Mode**
1. Run: `bun run dev` (starts both servers)
2. Open: http://localhost:5173
3. Verify: React app loads with "WhisperX" heading
4. Verify: Loading skeleton briefly visible on refresh
5. Open DevTools Network tab
6. Verify: No 404 errors for assets

**Test 2: Production Build from FastAPI**
1. Keep uvicorn running (or run: `bun run dev:api`)
2. Open: http://localhost:8000/ui
3. Verify: React app loads correctly
4. Verify: Assets load from /ui/assets/

**Test 3: SPA Routing (Page Refresh)**
1. Open: http://localhost:8000/ui
2. Manually change URL to: http://localhost:8000/ui/some-fake-route
3. Press Enter to navigate
4. Verify: React app loads (not FastAPI 404)
5. Refresh the page (F5)
6. Verify: Still shows React app (not 404)

**Test 4: API Routes Not Affected**
1. Open: http://localhost:8000/health
2. Verify: Returns JSON {"status": "ok", ...}
3. Verify: NOT caught by SPA handler

**Test 5: Noscript Fallback**
1. Open DevTools > Settings > Debugger > Disable JavaScript
2. Refresh http://localhost:8000/ui
3. Verify: Friendly message appears with purple gradient
4. Verify: Message says "Hey! This app needs a modern browser"
5. Re-enable JavaScript

**Test 6: API Proxy in Dev Mode**
1. In frontend/src/App.tsx, temporarily add:
   ```tsx
   useEffect(() => {
     fetch('/health').then(r => r.json()).then(console.log)
   }, [])
   ```
2. Save file (Vite hot-reloads)
3. Check browser console
4. Verify: Health check JSON logged (proxy working)
5. Remove the test code
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Phase 3 is complete when:
- Development mode works with hot-reload for both frontend and backend
- Production build serves correctly from FastAPI at /ui
- Client-side routing works on page refresh
- API routes remain accessible and not caught by SPA handler
- Loading skeleton and noscript fallback function correctly
</verification>

<success_criteria>
All ROADMAP success criteria for Phase 3 met:
1. User can access React application at /ui in browser
2. User can refresh any page without 404 error
3. Development mode proxies API and WebSocket calls
4. Production build serves static files from FastAPI
</success_criteria>

<output>
After completion, create `.planning/phases/03-build-integration-spa-serving/03-03-SUMMARY.md`
</output>
