---
phase: 04-core-upload-flow
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/types/upload.ts
  - frontend/src/lib/languageDetection.ts
  - frontend/src/lib/languages.ts
  - frontend/src/lib/whisperModels.ts
autonomous: true

must_haves:
  truths:
    - "FileQueueItem type correctly models queue state"
    - "Language detection extracts A03/A04/A05 patterns from filenames"
    - "Language list includes core 3 (Latvian, Russian, English) plus 10+ common languages"
    - "Whisper model list includes all sizes with large-v3 as default"
  artifacts:
    - path: "frontend/src/types/upload.ts"
      provides: "FileQueueItem, WhisperModel, Language types"
      exports: ["FileQueueItem", "WhisperModel", "Language", "FileQueueItemStatus"]
    - path: "frontend/src/lib/languageDetection.ts"
      provides: "detectLanguageFromFilename function"
      exports: ["detectLanguageFromFilename"]
    - path: "frontend/src/lib/languages.ts"
      provides: "LANGUAGES constant with grouped language list"
      exports: ["LANGUAGES", "LANGUAGE_GROUPS"]
    - path: "frontend/src/lib/whisperModels.ts"
      provides: "WHISPER_MODELS constant with model specs"
      exports: ["WHISPER_MODELS", "DEFAULT_MODEL"]
  key_links:
    - from: "frontend/src/lib/languageDetection.ts"
      to: "frontend/src/lib/languages.ts"
      via: "imports LANGUAGES for validation"
      pattern: "import.*LANGUAGES"
---

<objective>
Create TypeScript types and utility functions for the upload flow: file queue item modeling, language detection from filename patterns, and configuration constants.

Purpose: Establishes the data model and business logic that all upload components will share. Types ensure consistency; language detection implements the A03/A04/A05 pattern requirement.
Output: Type definitions for queue items, language detection utility, language list constant, Whisper model configuration.
</objective>

<execution_context>
@C:\Users\rolan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\rolan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-core-upload-flow/04-CONTEXT.md
@.planning/phases/04-core-upload-flow/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create upload types</name>
  <files>
    frontend/src/types/upload.ts
  </files>
  <action>
Create frontend/src/types/upload.ts with these type definitions:

```typescript
/**
 * Upload flow type definitions
 * Used by file queue, language detection, and model selection
 */

/** Whisper model sizes available for transcription */
export type WhisperModel = 'tiny' | 'base' | 'small' | 'medium' | 'large-v3' | 'turbo';

/** ISO 639-1 language codes supported for transcription */
export type LanguageCode =
  | 'lv' | 'ru' | 'en'  // Core 3
  | 'de' | 'fr' | 'es' | 'it' | 'pt' | 'nl' | 'pl'  // European
  | 'ja' | 'ko' | 'zh'  // Asian
  | 'ar' | 'hi' | 'tr';  // Other common

/** Status of a file in the upload queue */
export type FileQueueItemStatus = 'pending' | 'uploading' | 'processing' | 'complete' | 'error';

/** A file in the upload queue with its settings */
export interface FileQueueItem {
  /** Unique identifier for this queue item */
  id: string;
  /** The actual File object from the browser */
  file: File;
  /** Language detected from filename pattern (null if not detected) */
  detectedLanguage: LanguageCode | null;
  /** User-selected or auto-detected language for transcription */
  selectedLanguage: LanguageCode | '';
  /** User-selected Whisper model size */
  selectedModel: WhisperModel;
  /** Current status in the queue */
  status: FileQueueItemStatus;
  /** Error message if status is 'error' */
  errorMessage?: string;
}

/** Language definition for display */
export interface Language {
  code: LanguageCode;
  name: string;
  nativeName: string;
}

/** Whisper model definition for display */
export interface WhisperModelInfo {
  value: WhisperModel;
  label: string;
  description: string;
}
```

Note: LanguageCode uses union type for type safety. The list matches research recommendation (core 3 + 10-15 common).
  </action>
  <verify>
    - `cat frontend/src/types/upload.ts` shows all type definitions
    - `grep "FileQueueItem" frontend/src/types/upload.ts` shows interface
    - `grep "WhisperModel" frontend/src/types/upload.ts` shows type
  </verify>
  <done>
    - upload.ts exists with FileQueueItem, WhisperModel, LanguageCode, FileQueueItemStatus types
    - Language and WhisperModelInfo interfaces defined for UI display
    - All types are exported
  </done>
</task>

<task type="auto">
  <name>Task 2: Create language detection and constants</name>
  <files>
    frontend/src/lib/languageDetection.ts
    frontend/src/lib/languages.ts
  </files>
  <action>
Create frontend/src/lib/languages.ts with language constants:

```typescript
import type { Language, LanguageCode } from '@/types/upload';

/** Core languages (pinned at top of dropdown per user decision) */
export const CORE_LANGUAGES: Language[] = [
  { code: 'lv', name: 'Latvian', nativeName: 'Latviešu' },
  { code: 'ru', name: 'Russian', nativeName: 'Русский' },
  { code: 'en', name: 'English', nativeName: 'English' },
];

/** Additional common languages */
export const OTHER_LANGUAGES: Language[] = [
  { code: 'de', name: 'German', nativeName: 'Deutsch' },
  { code: 'fr', name: 'French', nativeName: 'Français' },
  { code: 'es', name: 'Spanish', nativeName: 'Español' },
  { code: 'it', name: 'Italian', nativeName: 'Italiano' },
  { code: 'pt', name: 'Portuguese', nativeName: 'Português' },
  { code: 'nl', name: 'Dutch', nativeName: 'Nederlands' },
  { code: 'pl', name: 'Polish', nativeName: 'Polski' },
  { code: 'ja', name: 'Japanese', nativeName: '日本語' },
  { code: 'ko', name: 'Korean', nativeName: '한국어' },
  { code: 'zh', name: 'Chinese', nativeName: '中文' },
  { code: 'ar', name: 'Arabic', nativeName: 'العربية' },
  { code: 'hi', name: 'Hindi', nativeName: 'हिन्दी' },
  { code: 'tr', name: 'Turkish', nativeName: 'Türkçe' },
];

/** All languages combined */
export const ALL_LANGUAGES: Language[] = [...CORE_LANGUAGES, ...OTHER_LANGUAGES];

/** Language lookup by code */
export const LANGUAGE_BY_CODE: Record<LanguageCode, Language> = Object.fromEntries(
  ALL_LANGUAGES.map(lang => [lang.code, lang])
) as Record<LanguageCode, Language>;

/** Get language name by code */
export function getLanguageName(code: LanguageCode): string {
  return LANGUAGE_BY_CODE[code]?.name ?? code;
}
```

Create frontend/src/lib/languageDetection.ts with detection logic:

```typescript
import type { LanguageCode } from '@/types/upload';

/**
 * Filename patterns that indicate language
 * Based on user requirement: A03=Latvian, A04=Russian, A05=English
 */
const LANGUAGE_PATTERNS: Record<string, LanguageCode> = {
  'A03': 'lv',
  'A04': 'ru',
  'A05': 'en',
};

/**
 * Detect language from filename pattern
 * Looks for A03, A04, A05 patterns anywhere in the filename (case-insensitive)
 *
 * @param filename - The filename to analyze
 * @returns Detected language code or null if no pattern found
 *
 * @example
 * detectLanguageFromFilename('interview_A03_final.mp3') // 'lv' (Latvian)
 * detectLanguageFromFilename('A04_recording.wav') // 'ru' (Russian)
 * detectLanguageFromFilename('meeting.mp3') // null
 */
export function detectLanguageFromFilename(filename: string): LanguageCode | null {
  // Match A03, A04, or A05 anywhere in filename (case-insensitive)
  const match = filename.match(/A0[345]/i);

  if (match) {
    const pattern = match[0].toUpperCase();
    return LANGUAGE_PATTERNS[pattern] ?? null;
  }

  return null;
}
```
  </action>
  <verify>
    - `cat frontend/src/lib/languages.ts` shows CORE_LANGUAGES and OTHER_LANGUAGES
    - `cat frontend/src/lib/languageDetection.ts` shows detectLanguageFromFilename function
    - `grep "A03" frontend/src/lib/languageDetection.ts` shows pattern mapping
  </verify>
  <done>
    - languages.ts exports CORE_LANGUAGES, OTHER_LANGUAGES, ALL_LANGUAGES, LANGUAGE_BY_CODE, getLanguageName
    - languageDetection.ts exports detectLanguageFromFilename function
    - Detection handles A03/A04/A05 patterns case-insensitively
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Whisper model constants</name>
  <files>
    frontend/src/lib/whisperModels.ts
  </files>
  <action>
Create frontend/src/lib/whisperModels.ts:

```typescript
import type { WhisperModel, WhisperModelInfo } from '@/types/upload';

/**
 * Available Whisper models with their specifications
 * Source: https://github.com/openai/whisper
 *
 * User preference: large-v3 as default (accuracy over speed)
 */
export const WHISPER_MODELS: WhisperModelInfo[] = [
  {
    value: 'tiny',
    label: 'Tiny',
    description: '39M params, ~1GB VRAM, fastest'
  },
  {
    value: 'base',
    label: 'Base',
    description: '74M params, ~1GB VRAM'
  },
  {
    value: 'small',
    label: 'Small',
    description: '244M params, ~2GB VRAM'
  },
  {
    value: 'medium',
    label: 'Medium',
    description: '769M params, ~5GB VRAM'
  },
  {
    value: 'large-v3',
    label: 'Large v3',
    description: '1.5B params, ~10GB VRAM, most accurate'
  },
  {
    value: 'turbo',
    label: 'Turbo',
    description: '809M params, ~6GB VRAM, fast + accurate'
  },
];

/** Default model (user preference: accuracy over speed) */
export const DEFAULT_MODEL: WhisperModel = 'large-v3';

/** Get model info by value */
export function getModelInfo(value: WhisperModel): WhisperModelInfo | undefined {
  return WHISPER_MODELS.find(model => model.value === value);
}
```
  </action>
  <verify>
    - `cat frontend/src/lib/whisperModels.ts` shows WHISPER_MODELS array
    - `grep "large-v3" frontend/src/lib/whisperModels.ts` shows default model
    - `grep "DEFAULT_MODEL" frontend/src/lib/whisperModels.ts` confirms export
  </verify>
  <done>
    - whisperModels.ts exports WHISPER_MODELS, DEFAULT_MODEL, getModelInfo
    - All 6 model sizes defined with labels and descriptions
    - large-v3 is the default (per user preference for accuracy)
  </done>
</task>

</tasks>

<verification>
1. Create directories if needed: `mkdir -p frontend/src/types frontend/src/lib`
2. Verify all files exist with correct exports
3. TypeScript compilation check: `cd frontend && bun run build` should succeed
4. No circular imports between types and lib files
</verification>

<success_criteria>
- frontend/src/types/upload.ts exists with all type definitions
- frontend/src/lib/languages.ts exports language constants (16 languages total)
- frontend/src/lib/languageDetection.ts exports working detection function
- frontend/src/lib/whisperModels.ts exports model configuration with large-v3 default
- All exports are properly typed
- Build succeeds without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-core-upload-flow/04-02-SUMMARY.md`
</output>
