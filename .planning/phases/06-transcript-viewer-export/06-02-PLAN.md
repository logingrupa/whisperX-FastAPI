---
phase: 06-transcript-viewer-export
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/lib/api/taskApi.ts
  - frontend/src/components/ui/collapsible.tsx
autonomous: true

must_haves:
  truths:
    - "API client can fetch completed task results with segments"
    - "API client returns typed TaskResult on success"
    - "API client returns ApiError on failure"
    - "Collapsible component provides expand/collapse functionality"
  artifacts:
    - path: "frontend/src/lib/api/taskApi.ts"
      provides: "Task result fetching"
      exports: ["fetchTaskResult"]
    - path: "frontend/src/components/ui/collapsible.tsx"
      provides: "Collapsible UI component"
      exports: ["Collapsible", "CollapsibleTrigger", "CollapsibleContent"]
  key_links:
    - from: "frontend/src/lib/api/taskApi.ts"
      to: "frontend/src/types/api.ts"
      via: "ApiResult type import"
      pattern: "import.*ApiResult.*from.*types/api"
---

<objective>
Create task result API client and Collapsible UI component

Purpose: Provide the API layer for fetching transcript results and the UI component for expandable transcript viewing

Output: API client function and Collapsible component ready for TranscriptViewer integration
</objective>

<execution_context>
@C:\Users\rolan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\rolan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-transcript-viewer-export/06-RESEARCH.md

# Existing API patterns
@frontend/src/lib/api/transcriptionApi.ts
@frontend/src/types/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create task result API client</name>
  <files>frontend/src/lib/api/taskApi.ts</files>
  <action>
Create `frontend/src/lib/api/taskApi.ts` following the existing pattern in `transcriptionApi.ts`:

```typescript
/**
 * API client for task management
 */
import type { ApiResult } from '@/types/api';
import type { TaskResult } from '@/types/transcript';

/**
 * Fetch task result including transcript segments
 *
 * Retrieves full task details from GET /task/{identifier}.
 * Only call this for completed tasks - the result.segments array
 * will be null/undefined for tasks still in progress.
 *
 * @param taskId - The task identifier (UUID)
 * @returns Task result on success, error details on failure
 */
export async function fetchTaskResult(
  taskId: string
): Promise<ApiResult<TaskResult>> {
  try {
    const response = await fetch(`/task/${taskId}`);

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({ detail: 'Unknown error' }));
      return {
        success: false,
        error: {
          status: response.status,
          detail: errorData.detail || `HTTP ${response.status}`,
        },
      };
    }

    const data: TaskResult = await response.json();
    return { success: true, data };

  } catch (error) {
    // Network error or other failure
    return {
      success: false,
      error: {
        status: 0,
        detail: error instanceof Error ? error.message : 'Network error',
      },
    };
  }
}
```

IMPORTANT: This uses the existing ApiResult pattern from types/api.ts for consistency with transcriptionApi.ts.
  </action>
  <verify>TypeScript compiles: `cd frontend && bunx tsc --noEmit`</verify>
  <done>Task API client can fetch task results with proper error handling</done>
</task>

<task type="auto">
  <name>Task 2: Create Collapsible component</name>
  <files>frontend/src/components/ui/collapsible.tsx</files>
  <action>
Create `frontend/src/components/ui/collapsible.tsx` following manual shadcn/ui setup pattern (Tailwind v4 incompatibility with CLI):

```typescript
"use client"

import * as React from "react"
import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger

const CollapsibleContent = React.forwardRef<
  React.ElementRef<typeof CollapsiblePrimitive.CollapsibleContent>,
  React.ComponentPropsWithoutRef<typeof CollapsiblePrimitive.CollapsibleContent>
>(({ className, children, ...props }, ref) => (
  <CollapsiblePrimitive.CollapsibleContent
    ref={ref}
    className={className}
    {...props}
  >
    {children}
  </CollapsiblePrimitive.CollapsibleContent>
))
CollapsibleContent.displayName = CollapsiblePrimitive.CollapsibleContent.displayName

export { Collapsible, CollapsibleTrigger, CollapsibleContent }
```

Then install the Radix dependency:
```bash
cd frontend && bun add @radix-ui/react-collapsible
```

This follows the established pattern from other shadcn/ui components in the codebase (button.tsx, select.tsx, etc.).
  </action>
  <verify>
    1. Dependency installed: `cd frontend && bun pm ls | grep collapsible`
    2. TypeScript compiles: `cd frontend && bunx tsc --noEmit`
  </verify>
  <done>Collapsible component available for transcript expand/collapse UI</done>
</task>

</tasks>

<verification>
After all tasks:
1. `cd frontend && bunx tsc --noEmit` - TypeScript compiles without errors
2. `cd frontend && bun run build` - Build succeeds
3. @radix-ui/react-collapsible is in package.json dependencies
</verification>

<success_criteria>
- fetchTaskResult returns ApiResult<TaskResult> with typed response
- fetchTaskResult handles network errors gracefully
- Collapsible component exports Collapsible, CollapsibleTrigger, CollapsibleContent
- Collapsible uses @radix-ui/react-collapsible under the hood
</success_criteria>

<output>
After completion, create `.planning/phases/06-transcript-viewer-export/06-02-SUMMARY.md`
</output>
