---
phase: 05-real-time-progress-tracking
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/bun.lock
  - frontend/src/components/ui/progress.tsx
  - frontend/src/index.css
  - frontend/src/types/upload.ts
  - frontend/src/types/websocket.ts
  - frontend/src/lib/progressStages.ts
autonomous: true

must_haves:
  truths:
    - "ProgressStage type matches backend stages exactly"
    - "Stage config provides friendly names, colors, and step numbers"
    - "Progress bar animates smoothly between values"
  artifacts:
    - path: "frontend/src/components/ui/progress.tsx"
      provides: "Accessible progress bar component"
      contains: "Progress"
    - path: "frontend/src/types/websocket.ts"
      provides: "WebSocket message types matching backend schemas"
      exports: ["ProgressMessage", "ErrorMessage", "HeartbeatMessage"]
    - path: "frontend/src/lib/progressStages.ts"
      provides: "Stage configuration with labels and colors"
      exports: ["STAGE_CONFIG", "FRIENDLY_STAGE_NAMES"]
  key_links:
    - from: "frontend/src/types/websocket.ts"
      to: "app/schemas/websocket_schemas.py"
      via: "Matching type definitions"
      pattern: "ProgressStage.*uploading.*queued.*transcribing"
---

<objective>
Install WebSocket library and create type definitions for progress tracking

Purpose: Establish the foundation (types, components, configuration) for progress UI
Output: react-use-websocket installed, shadcn/ui Progress component, TypeScript types matching backend, stage configuration
</objective>

<execution_context>
@C:\Users\rolan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\rolan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-real-time-progress-tracking/05-CONTEXT.md
@.planning/phases/05-real-time-progress-tracking/05-RESEARCH.md

# Backend WebSocket schemas to match
@app/schemas/websocket_schemas.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-use-websocket and add shadcn/ui Progress component</name>
  <files>
    - frontend/package.json
    - frontend/bun.lock
    - frontend/src/components/ui/progress.tsx
    - frontend/src/index.css
  </files>
  <action>
    1. From frontend/ directory, install react-use-websocket:
       ```bash
       bun add react-use-websocket
       ```

    2. Add shadcn/ui Progress component. Since Tailwind v4 CLI incompatibility exists (per Phase 4 decisions), create manually:

       Create `frontend/src/components/ui/progress.tsx`:
       ```typescript
       import * as React from "react"
       import * as ProgressPrimitive from "@radix-ui/react-progress"
       import { cn } from "@/lib/utils"

       function Progress({
         className,
         value,
         ...props
       }: React.ComponentProps<typeof ProgressPrimitive.Root>) {
         return (
           <ProgressPrimitive.Root
             data-slot="progress"
             className={cn(
               "bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",
               className
             )}
             {...props}
           >
             <ProgressPrimitive.Indicator
               data-slot="indicator"
               className="bg-primary h-full w-full flex-1 transition-transform duration-500 ease-out"
               style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
             />
           </ProgressPrimitive.Root>
         )
       }

       export { Progress }
       ```

    3. Add CSS for smooth progress animation to frontend/src/index.css (add after existing styles):
       ```css
       /* Progress bar smooth animation */
       [data-slot="indicator"] {
         transition: transform 500ms ease-out;
       }
       ```

    4. Verify build passes: `bun run build`
  </action>
  <verify>
    - `bun run build` completes without errors
    - package.json contains react-use-websocket dependency
    - progress.tsx file exists with Progress component export
  </verify>
  <done>
    react-use-websocket installed, shadcn/ui Progress component created with smooth animation CSS
  </done>
</task>

<task type="auto">
  <name>Task 2: Create progress types and stage configuration</name>
  <files>
    - frontend/src/types/upload.ts
    - frontend/src/types/websocket.ts
    - frontend/src/lib/progressStages.ts
  </files>
  <action>
    1. Create `frontend/src/types/websocket.ts` matching backend schemas exactly:
       ```typescript
       /**
        * WebSocket message types matching backend app/schemas/websocket_schemas.py
        */

       /** Progress stages matching backend ProgressStage enum */
       export type ProgressStage =
         | 'uploading'
         | 'queued'
         | 'transcribing'
         | 'aligning'
         | 'diarizing'
         | 'complete';

       /** Progress update from WebSocket */
       export interface ProgressMessage {
         type: 'progress';
         task_id: string;
         stage: ProgressStage;
         percentage: number;
         message: string | null;
         timestamp: string;
       }

       /** Error message from WebSocket */
       export interface ErrorMessage {
         type: 'error';
         task_id: string;
         error_code: string;
         user_message: string;
         technical_detail: string | null;
         timestamp: string;
       }

       /** Heartbeat message from WebSocket */
       export interface HeartbeatMessage {
         type: 'heartbeat';
         timestamp: string;
       }

       /** Union of all WebSocket message types */
       export type WebSocketMessage = ProgressMessage | ErrorMessage | HeartbeatMessage;
       ```

    2. Create `frontend/src/lib/progressStages.ts` with stage configuration per CONTEXT.md:
       ```typescript
       import type { ProgressStage } from '@/types/websocket';

       /** Friendly stage names per CONTEXT.md decisions */
       export const FRIENDLY_STAGE_NAMES: Record<ProgressStage, string> = {
         uploading: 'Uploading',
         queued: 'Queued',
         transcribing: 'Converting Speech',
         aligning: 'Syncing Timing',
         diarizing: 'Identifying Speakers',
         complete: 'Done',
       };

       /** Stage step numbers (out of 5 total processing stages, excluding upload) */
       export const STAGE_STEPS: Record<ProgressStage, number> = {
         uploading: 0,  // Not counted in processing steps
         queued: 1,
         transcribing: 2,
         aligning: 3,
         diarizing: 4,
         complete: 5,
       };

       /** Total number of processing steps (excluding upload) */
       export const TOTAL_STEPS = 5;

       /** Stage color classes per CONTEXT.md: Upload=blue, Processing=yellow, Complete=green, Error=red */
       export const STAGE_COLORS: Record<ProgressStage | 'error', string> = {
         uploading: 'bg-blue-500 text-white',
         queued: 'bg-blue-500 text-white',
         transcribing: 'bg-yellow-500 text-black',
         aligning: 'bg-yellow-500 text-black',
         diarizing: 'bg-yellow-500 text-black',
         complete: 'bg-green-500 text-white',
         error: 'bg-red-500 text-white',
       };

       /** Stage configuration combining all stage metadata */
       export interface StageConfig {
         label: string;
         step: number;
         color: string;
       }

       export function getStageConfig(stage: ProgressStage): StageConfig {
         return {
           label: FRIENDLY_STAGE_NAMES[stage],
           step: STAGE_STEPS[stage],
           color: STAGE_COLORS[stage],
         };
       }

       /** Get tooltip text listing all stages */
       export function getStageTooltip(): string {
         return 'Queued → Converting Speech → Syncing Timing → Identifying Speakers → Done';
       }
       ```

    3. Extend `frontend/src/types/upload.ts` to add progress-related fields to FileQueueItem:
       Add new fields to the FileQueueItem interface (after errorMessage):
       ```typescript
       /** Backend task ID for WebSocket subscription (set after upload starts) */
       taskId?: string;
       /** Current progress percentage (0-100) */
       progressPercentage?: number;
       /** Current processing stage */
       progressStage?: ProgressStage;
       ```

       Also add import at top:
       ```typescript
       import type { ProgressStage } from './websocket';
       ```

       Note: Re-export ProgressStage from upload.ts for convenience:
       ```typescript
       export type { ProgressStage } from './websocket';
       ```

    4. Verify TypeScript compilation: `bun run build`
  </action>
  <verify>
    - `bun run build` completes without errors
    - websocket.ts exports ProgressMessage, ErrorMessage, HeartbeatMessage, WebSocketMessage
    - progressStages.ts exports FRIENDLY_STAGE_NAMES, STAGE_COLORS, getStageConfig, getStageTooltip
    - upload.ts FileQueueItem has taskId, progressPercentage, progressStage fields
  </verify>
  <done>
    TypeScript types match backend WebSocket schemas, stage configuration provides friendly names and colors per CONTEXT.md
  </done>
</task>

</tasks>

<verification>
1. `bun run build` passes without errors
2. Progress component renders (will test in Plan 03 when integrated)
3. TypeScript types are complete and match backend schemas
4. Stage configuration provides all required metadata (names, colors, steps)
</verification>

<success_criteria>
- react-use-websocket v4.x installed
- shadcn/ui Progress component with smooth CSS animation
- WebSocket message types matching backend exactly
- Stage configuration with friendly names and colors per CONTEXT.md
- FileQueueItem extended with progress fields
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-real-time-progress-tracking/05-01-SUMMARY.md`
</output>
