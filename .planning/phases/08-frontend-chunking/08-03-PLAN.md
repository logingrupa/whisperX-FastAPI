---
phase: 08-frontend-chunking
plan: 03
type: execute
wave: 3
depends_on: ["08-02"]
files_modified:
  - frontend/src/components/upload/FileProgress.tsx
  - frontend/src/components/upload/FileQueueItem.tsx
autonomous: false

must_haves:
  truths:
    - "User sees upload percentage in progress bar during upload"
    - "User sees upload speed (MB/s) during chunked upload"
    - "User sees estimated time remaining during chunked upload"
    - "Progress display is identical visual component for both direct and chunked uploads"
    - "Upload complete transitions to transcription processing state"
  artifacts:
    - path: "frontend/src/components/upload/FileProgress.tsx"
      provides: "Progress bar with speed and ETA display"
    - path: "frontend/src/components/upload/FileQueueItem.tsx"
      provides: "Passes uploadSpeed/uploadEta from FileQueueItem to FileProgress"
  key_links:
    - from: "frontend/src/components/upload/FileQueueItem.tsx"
      to: "frontend/src/components/upload/FileProgress.tsx"
      via: "speed and eta props"
      pattern: "uploadSpeed|uploadEta"
    - from: "frontend/src/components/upload/FileProgress.tsx"
      to: "speed/eta display"
      via: "conditional rendering below progress bar"
      pattern: "speedFormatted|etaFormatted|MB/s"
---

<objective>
Add upload speed and ETA display to the progress bar component.

Purpose: Fulfills FRONT-05 (speed in MB/s) and FRONT-06 (estimated time remaining). Makes the unified progress display informative for large file uploads. Includes visual verification checkpoint.
Output: Enhanced FileProgress with speed/ETA, FileQueueItem passing the data through.
</objective>

<execution_context>
@C:\Users\rolan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\rolan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-frontend-chunking/08-CONTEXT.md
@.planning/phases/08-frontend-chunking/08-02-SUMMARY.md

Key existing files:
@frontend/src/components/upload/FileProgress.tsx
@frontend/src/components/upload/FileQueueItem.tsx
@frontend/src/types/upload.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance FileProgress with speed and ETA display</name>
  <files>
    frontend/src/components/upload/FileProgress.tsx
    frontend/src/components/upload/FileQueueItem.tsx
  </files>
  <action>
    1. Modify `frontend/src/components/upload/FileProgress.tsx`:
       - Add optional props to `FileProgressProps`:
         ```typescript
         /** Upload speed display (e.g., "12.3 MB/s") */
         uploadSpeed?: string;
         /** Estimated time remaining (e.g., "2m 15s") */
         uploadEta?: string;
         ```
       - Add a secondary info row below the progress bar, shown only when speed or ETA is available:
         ```tsx
         {(uploadSpeed || uploadEta) && (
           <div className="flex justify-between text-xs text-muted-foreground mt-1">
             <span>{uploadSpeed || ''}</span>
             <span>{uploadEta || ''}</span>
           </div>
         )}
         ```
       - The speed shows on the left, ETA on the right, below the progress bar
       - When neither speed nor ETA is set (direct upload or processing phase), the row is hidden -- this keeps the component identical for both paths visually when no metrics are available
       - Keep the existing progress bar + percentage + spinner layout unchanged

    2. Modify `frontend/src/components/upload/FileQueueItem.tsx`:
       - In the progress bar rendering section (where `<FileProgress>` is used), pass the new props:
         ```tsx
         {isProcessing && item.progressPercentage !== undefined && (
           <FileProgress
             percentage={item.progressPercentage}
             showSpinner={true}
             uploadSpeed={item.uploadSpeed}
             uploadEta={item.uploadEta}
           />
         )}
         ```
       - The `item.uploadSpeed` and `item.uploadEta` fields come from the extended `FileQueueItem` type (added in Plan 02, Task 1)
       - For direct uploads (< 80MB), these fields will be undefined, so the speed/ETA row simply won't render
       - For TUS uploads (>= 80MB), the orchestration hook sets these fields via updateFileUploadMetrics

    DESIGN NOTES:
    - The speed/ETA row is a subtle addition below the progress bar, not a replacement
    - Per CONTEXT.md: "Reuse/adapt existing v1.0 progress UI component -- not a new component"
    - Per CONTEXT.md: "Progress bar is identical for both direct and chunked uploads -- same visual, same stats"
    - The component gracefully degrades: no speed/ETA data = same appearance as v1.0
  </action>
  <verify>
    - `cd frontend && bun run tsc --noEmit` passes
    - `cd frontend && bun run build` passes
    - FileProgress accepts optional uploadSpeed and uploadEta props
    - FileQueueItem passes item.uploadSpeed and item.uploadEta to FileProgress
    - When uploadSpeed/uploadEta are undefined, the component renders identically to v1.0
  </verify>
  <done>
    FileProgress shows upload speed (left) and ETA (right) below the progress bar when available. Invisible for direct uploads. FileQueueItem passes through the data.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 8 frontend chunking implementation:
    1. TUS upload library (tus-js-client wrapper, speed tracker, constants)
    2. File size routing (>= 80MB TUS, < 80MB direct) in orchestration hook
    3. Pre-generated taskId handoff via TUS metadata
    4. Progress bar with speed (MB/s) and ETA display
    5. Backend support for client-provided taskId
    6. Vite proxy for /uploads development path
  </what-built>
  <how-to-verify>
    1. Start the backend: `python -m uvicorn app.main:app --reload`
    2. Start the frontend: `cd frontend && bun run dev`
    3. Open http://localhost:5173/ui/ in browser

    **Test 1: Small file (< 80MB) -- existing flow unchanged**
    - Drop a small audio file (e.g., < 50MB)
    - Select language, click Start
    - Verify: Upload and transcription work as before (no speed/ETA shown during upload, transcription progress shows normally)

    **Test 2: Large file (>= 80MB) -- TUS chunked upload**
    - Drop a large audio/video file (>= 80MB)
    - Select language, click Start
    - Verify: Progress bar shows upload percentage advancing smoothly
    - Verify: Speed (e.g., "12.3 MB/s") appears below progress bar on the left
    - Verify: ETA (e.g., "2m 15s") appears below progress bar on the right
    - Verify: After upload reaches 100%, status transitions to processing/transcription
    - Verify: Transcription progress updates appear via WebSocket

    **Test 3: Multiple files**
    - Drop one small and one large file
    - Click Start All
    - Verify: Files process sequentially
    - Verify: Each file shows appropriate progress for its upload path

    If any test fails, describe what happened vs. what was expected.
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `cd frontend && bun run tsc --noEmit` - TypeScript compiles
2. `cd frontend && bun run build` - Production build succeeds
3. Visual: Progress bar shows speed and ETA for large file uploads
4. Visual: Small file uploads look identical to v1.0 (no speed/ETA row)
5. Functional: Large file upload completes and transitions to transcription
</verification>

<success_criteria>
- User drops a 200MB file and sees single smooth progress bar with speed and ETA (FRONT-04, FRONT-05, FRONT-06)
- Files under 80MB use existing upload flow without TUS overhead (FRONT-01)
- Upload completes and transcription begins automatically (phase success criterion 4)
- Progress display is the same component for both paths
</success_criteria>

<output>
After completion, create `.planning/phases/08-frontend-chunking/08-03-SUMMARY.md`
</output>
